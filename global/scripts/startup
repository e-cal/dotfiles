#!/usr/bin/env bash

INTERVAL="1m"

if [[ $1 == "cancel" ]]; then
	touch /tmp/force-stop-startup-download
	exit
fi

launch-bar &
dropbox &
redshift &
eyes &
yay -Syyy &
config-wacom m &

if [[ $HOSTNAME == "coeus" ]]; then
	~/projects/archillect/get-images
	mainbg="/home/ecal/images/wallpapers/introspection.jpg"
	tallbg="/home/ecal/images/wallpapers/soup.jpg"
	altbg="/home/ecal/projects/archillect/images/img$(perl -e 'print int rand 10, "\n"; ').jpg"
	# feh --no-fehbg --bg-fill "$mainbg" "$tallbg" "$altbg"
fi

# Update volume 5 times
for i in {0..5}; do
	sleep 3
	polybar-msg -p "$(pgrep -f "polybar $(get-bar)")" hook volume 1 &>/dev/null
done

cloud backup
cloud download all >~/.local/share/rclone/startup-sync.log
while [[ $? != 0 ]]; do
	dunstify "Startup file sync" "Retrying in $INTERVAL"
	sleep $INTERVAL
	cloud download all >~/.local/share/rclone/startup-sync.log
	if [[ -f /tmp/force-stop-startup-download ]]; then
		dunstify "Startup file sync" "Aborting file sync. Files may be out of date."
		rm /tmp/force-stop-startup-download
		exit
	fi
done
