#!/usr/bin/env bash

cd $STOW_DIR
if [[ $# > 0 ]]; then
    case $1 in
        all | a | -a | --all)
            git diff | bat
            ;;
        *)
            git diff $@ | bat
            ;;
    esac
    exit 0
fi

changed=`.status -s | awk '{print $2}'`


sel=`printf "%s\n" $changed | fzf --header="modified files" -m --bind space:toggle $FZF_INLINE`
[[ -z $sel ]] && exit 1

for f in $sel; do
    echo >> tmp.diff
    yes "=" | head -n 80 | tr "\n" "," | sed "s/,//g" >> tmp.diff
    printf "\n$f\n" >> tmp.diff
    yes "=" | head -n 80 | tr "\n" "," | sed "s/,//g" >> tmp.diff
    printf "\n\n" >> tmp.diff

    git --no-pager diff $f >> tmp.diff
done
bat tmp.diff
rm tmp.diff



